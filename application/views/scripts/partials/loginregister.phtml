<?php
/**
 * builds the form for registration and login
 * @param int $this -> register_status the regitration code for user report
 * @param int $this -> login_status the regitration code for user report
 */
?>

<div id="loginregister" class="loginregister dialog">
    <div style="width: 100%; text-align: right;">
        <a style="position: relative; clear: both; display: inline-block; top: 17px; left: 17px;" class="closedialog" onclick="$('#loginregister').fadeOut('normal');$('#glassloading').fadeOut('fast');" href="javascript:void(0)">
            <span>
            X
            </span>
        </a>
    </div>
    <div class="loginregister_header">
        <a id="logintab" class="loginregister_tab active" onclick="showSignIn();">
            <span class="dialogfont " style="left: 79px;">Sign In</span>
        </a>
        <a id="registertab" class="loginregister_tab" onclick="showRegister();">
            <span class="dialogfont" style="left: 74px;">Register</span>
        </a>
    </div>
    <div class="loginregister_body dialogbg">
        
        <!-- Begin Successfull activation -->
        <div id="login_success_activate" style="margin: 0px auto; position: absolute; width: 90%; top: 75px; left: 22px;display: none;">
            <table style="margin: 0px auto; color: green;">
                <tr>
                    <td>
                        <img src="/img/Success1.png" width="64" />
                    </td>
                    <td>
                        <p style="margin-left: 8px;">
                            <?php 
                            /**
                             * @var array $temp
                             */
                            $cNErrors = new Nerdeez_Errors();
                            $aMessages = $cNErrors ->MESSAGES;
                            echo $aMessages[$this->login_status];
                            ?>
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        <!-- End Successfull activation -->
        
        <!-- Begin login error -->
        <div id="login_failed" style="margin: 0px auto; position: absolute; width: 90%; top: 81px; left: 22px;display: none;">
            <table style="margin: 0 auto; color: #E62A59;">
                <tr>
                    <td>
                        <img src="/img/X.png" width="64" />
                    </td>
                    <td>
                        <p style="margin-left: 8px;">
                            <?php 
                            /**
                             * @var array $temp
                             */
                            $cNErrors = new Nerdeez_Errors();
                            $aMessages = $cNErrors ->MESSAGES;
                            echo $aMessages[$this -> login_status];
                            ?>
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        <!-- End login error-->
        
        <!-- begin of login -->
        <div style="width: 330px; margin-right: auto; margin-bottom: 0px; margin-left: auto; height: 242px; position: relative; top: 67px;" id="login">
            <form 
            method="post" 
            action="https://<?php $ksfunctions = new Application_Model_KSFunctions(); echo $ksfunctions -> sGetUrl(); ?>/login/login">
            <div style="height: 57px;">
                <table style="width: 100%;">
                    <tr>
                        <td>
                            <span class="dialogfontbody">
                            Email
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="front-card">
                                <div class="searchcourse flex-table-form">
                                     <input 
                                        type="text" 
                                        autocomplete="on" 
                                        title="Email" 
                                        name="email" 
                                        class="text-input email-input nerdeez_dialog"
                                        style="width: 100%"
                                        maxlength="100" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="register-error-placeholder email" id="login_email_error"></div>
                        </td>
                    </tr>
                </table>
            </div>
            <div style="height: 57px; margin-top: 16px;">
                <table style="width: 100%; height: 78px;">
                    <tr style="height: 20px">
                        <td>
                            <span class="dialogfontbody">
                            Password
                            </span>
                        </td>
                    </tr>
                    <tr style="height: 25px;">
                        <td style="vertical-align:top;">
                            <div class="front-card">
                                <div class="searchcourse flex-table-form">
                                    <input 
                                        type="password" 
                                        title="Password" 
                                        name="password"
                                        style="width: 100%;"
                                        class="text-input email-input nerdeez_dialog"
                                        maxlength="100" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="register-error-placeholder password" id="login_password_error"></div>
                        </td>
                    </tr>
                    <tr style="height: 20px;">
                        <td>
                            <a href="javascript:void(0)" onclick="showForgotPassword();" class="forgot2">Forgot your password?</a>
                        </td>
                    </tr>
                </table>
            </div>
            <div style="margin-top: 54px;">
                <div style="float: left; position: relative; top: 12px; width: 116px;">
                    <label class="remember">
                        <input type="checkbox" name="rememberme" value="1" checked="on"/>
                        <span class="dialogfontbody" style="position: relative; top: -2px;">Remember me</span>
                    </label>
                </div>
                <div style="width: 98px; float: right;height: 44px;">
                    <button 
                            class="filebrowserbutton" 
                            type="submit" 
                            style="height: 44px !important;"
                            tabindex="0">SIGN IN
                    </button>
                </div>
            </div>
            </form>
        </div>
        <!-- end of login -->
        
        <!-- begin of register -->
        <div id="register" style="margin-right: auto; margin-bottom: 0px; margin-left: auto; position: relative; top: 27px; width: 330px;">
            <form action="https://<?php $ksfunctions = new Application_Model_KSFunctions(); echo $ksfunctions ->sGetUrl();  ?>/register/signup" class="signin registerform" method="post">
                <div style="height: 57px">
                    <table style="width: 100%;">
                        <tr>
                            <td>
                                <span class="dialogfontbody">
                                Email
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="front-card">
                                    <div class="username" style="width: 100%">
                                        <input 
                                                type="text" 
                                                autocomplete="on" 
                                                title="Email" 
                                                name="email" 
                                                id="register_input_email"
                                                class="text-input email-input nerdeez_dialog"
                                                maxlength="100" 
                                                style="width: 100%;" />
                                        
                                    </div>          
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="register-error-placeholder email" id="register_email_error"></div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="height: 57px;margin-top: 15px;">
                    <table style="width: 100%;">
                        <tr>
                            <td>
                                <span class="dialogfontbody">
                                Password
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="front-card">
                                    <div class="username" style="width: 100%">
                                        <input type="password" maxlength="100" 
                                               class="text-input email-input pass nerdeez_dialog" 
                                               name="password" 
                                               id="register_input_password"
                                               title="Password" 
                                               style="width: 100%;" />
                                    </div>          
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="register-error-placeholder password" id="register_password_error"></div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="height: 57px;margin-top: 15px;">
                    <table style="width: 100%;">
                        <tr>
                            <td>
                                <span class="dialogfontbody">
                                Retype Password
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="front-card">
                                    <div class="username" style="width: 100%">
                                        <input type="password" maxlength="100" 
                                               class="text-input email-input nerdeez_dialog" 
                                               name="repassword" 
                                               title="Password" 
                                               id="register_input_repassword"
                                               style="width: 100%;" />
                                    </div>          
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="register-error-placeholder repassword" id="register_repassword_error"></div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="text-align: center; margin-bottom: 4px; margin-top: 16px;">
                    By clicking Register, you agree to our <a href="/index/terms/" target="_blank">Terms</a>
                </div>
                <div class="error" id="register_error" style="float: left; max-width: 202px; margin-top: 19px;">
                </div>
                <div style="width: 98px; height: 44px; float: right; margin-top: 10px;">
                    <button 
                        tabindex="0" 
                        type="submit" 
                        class="filebrowserbutton" 
                        style="height: 44px;">Register
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Begin Success message -->
        <div class="dialog_success" id="register_success" >
            <table>
                <tr>
                    <td>
                        <img src="/img/Success1.png" width="80px" />
                    </td>
                    <td>
                        <p style="margin-left: 8px;">
                            An account activation email was sent to <span id="register_email_feedback">abc@gmail.com</span> Please follow the link in the email to complete registration.
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        <!-- End success message -->
        
        <script type="text/javascript">
            loadLogin();
            loadRegistration();
        </script>
        <!-- end of register -->
    </div> 
</div>

<!-- Begin forgot password login -->
<div id="forget_password_dialog" class="flagdialog dialogbg dialog" style="width: 534px;height: 258px;">
    <form action="/" method="post">
        <div class="bgblack flagdialog_header" >
            <h2 style="color: white; margin: 2px auto 0px; position: relative; top: 10px; font-weight: normal; font-size: 18px; width: 210px;">
                Forgot your password?
            </h2>
            <a href="javascript:void(0)" onclick="$('#forget_password_dialog').fadeOut('normal');$('#glassloading').fadeOut('fast');" class="closedialog" style="position: relative; top: -42px; left: 23px;">
                <span>
                X
                </span>
            </a>
        </div>
        <div id="forget_password_dialog_error">
            <table style="width: 100%">
                <tr>
                    <td>
                        <img src="/img/X.png" width="64" />
                    </td>
                    <td>
                        <p></p>
                    </td>
                </tr>
            </table>
        </div>
        <div id="forget_password_dialog_success">
            <table style="width: 100%;">
                <tr>
                    <td>
                        <img src="/img/Success1.png" width="64" />
                    </td>
                    <td>
                        <p>Email was sent with a link to reset your password</p>
                    </td>
                </tr>
            </table>
        </div>
        <div id="forget_password_dialog_body">
            <div class="flagdialog_body">
                <p style="text-align: center;">
                    Write your account email in the text box below.
                </p>
            </div>
            <div style="width: 400px; margin: 0px auto; position: relative; top: -18px;">
                <table style="width: 100%;">
                    <tr>
                        <td>
                            <span class="dialogfontbody">
                                Email
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="front-card">
                                <div class="placeholding-input searchcourse flex-table-form">
                                    <input 
                                                    type="text" 
                                                    autocomplete="on" 
                                                    title="Email" 
                                                    name="email" 
                                                    class="text-input email-input"
                                                    style="width: 100%; position: relative !important;"
                                                    id="forget_password_dialog_textbox"
                                                    maxlength="100" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr style="height: 15px;">
                        <td>
                            <div class="register-error-placeholder" id="forget_password_email_error"></div>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: right">
                            <button class="filebrowserbutton" type="button" onclick="sendForgetPassword();" value="Submit" style="height: 38px; width: 100px; float: right;">
                                Submit
                            </button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </form>
</div>      
<script type="text/javascript">
    loadForgetPassword();
</script>
<!-- End forgot password dialog-->

<?php
//determine if dialogs should be displayed on page load
if (isset($this -> login_status)):
?>
    <script type="text/javascript">
        showLoginMenu();
    </script>
<?php elseif(isset($this -> register_status)): ?>
    <script type="text/javascript">
        showRegisterMenu();
    </script>
<?php endif; ?>

<?php 
if (isset($this -> login_status) && 
        ($this -> login_status == Nerdeez_Errors::LOGIN_ACTIVATED || $this -> login_status == Nerdeez_Errors::LOGIN_PASSWORD_CHANGED)):
?>
    <script type="text/javascript">
        $('#login_success_activate').css('display', 'block');
    </script>
<?php
endif;
?>
<?php 
if (isset($this -> login_status) && 
        $this -> login_status != Nerdeez_Errors::LOGIN_ACTIVATED &&
        $this -> login_status != Nerdeez_Errors::LOGIN_PASSWORD_CHANGED):
?>
    <script type="text/javascript">
        $('#login_failed').css('display', 'block');
    </script>
<?php
endif;
?>
<?php 
if (isset($this -> register_status) && $this -> register_status == Nerdeez_Errors::SUCCESS):
?>
    <script type="text/javascript">
        $('#register_email_feedback').text('<?php echo $this -> email; ?>');
        $('#register_success').css('display', 'block');
        $('#register').css('display', 'none');
    </script>
<?php
endif;
?>
<?php 
if (isset($this -> register_status) && $this -> register_status == Nerdeez_Errors::EMAIL_EXISTS):
?>
    <script type="text/javascript">
        $('#register_email_error').text('<?php echo $cNErrors -> MESSAGES[Nerdeez_Errors::EMAIL_EXISTS]; ?>');
    </script>
<?php
endif;
?>
<?php 
if (isset($this -> register_status) && $this -> register_status == Nerdeez_Errors::EMAIL_INVALID):
?>
    <script type="text/javascript">
        $('#register_email_error').text('<?php echo $cNErrors -> MESSAGES[Nerdeez_Errors::EMAIL_INVALID]; ?>');
    </script>
<?php
endif;
?>
<?php 
if (isset($this -> register_status) && $this -> register_status == Nerdeez_Errors::PASSWORD_LENGTH):
?>
    <script type="text/javascript">
        $('#register_password_error').text('<?php echo $cNErrors -> MESSAGES[Nerdeez_Errors::PASSWORD_LENGTH]; ?>');
    </script>
<?php
endif;
?>
<?php 
if (isset($this -> register_status) && $this -> register_status == Nerdeez_Errors::PASSWORD_MISMATCH):
?>
    <script type="text/javascript">
        $('#register_repassword_error').text('<?php echo $cNErrors -> MESSAGES[Nerdeez_Errors::PASSWORD_MISMATCH]; ?>');
    </script>
<?php
endif;
?>

